@echo off
chcp 65001 >nul
setlocal EnableDelayedExpansion

echo.
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo               ðŸš€ ì—‘ì…€ í†µí•©ê¸° ìžë™ ì„¤ì¹˜ ë° ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸
echo                    ðŸ“§ ì œìž‘ìž: charmleader@gmail.com
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

:: ê´€ë¦¬ìž ê¶Œí•œ í™•ì¸
net session >nul 2>&1
if %errorLevel% neq 0 (
    echo âš ï¸  ê´€ë¦¬ìž ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤!
    echo    ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìš°í´ë¦­ â†’ "ê´€ë¦¬ìž ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰"í•´ì£¼ì„¸ìš”.
    echo.
    pause
    exit /b 1
)

echo âœ… ê´€ë¦¬ìž ê¶Œí•œ í™•ì¸ ì™„ë£Œ
echo.

:: 1. Python ì„¤ì¹˜ í™•ì¸ ë° ìžë™ ì„¤ì¹˜
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo 1ï¸âƒ£  Python ì„¤ì¹˜ ìƒíƒœ í™•ì¸ ì¤‘...
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

python --version >nul 2>&1
if %errorLevel% neq 0 (
    echo âŒ Pythonì´ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ìžë™ìœ¼ë¡œ ì„¤ì¹˜í•©ë‹ˆë‹¤...
    echo.
    
    :: Python ë‹¤ìš´ë¡œë“œ URL (ìµœì‹  3.11 ë²„ì „)
    set PYTHON_URL=https://www.python.org/ftp/python/3.11.7/python-3.11.7-amd64.exe
    set PYTHON_INSTALLER=python_installer.exe
    
    echo ðŸ“¥ Python 3.11.7 ë‹¤ìš´ë¡œë“œ ì¤‘... (ì•½ 2-5ë¶„ ì†Œìš”)
    echo    URL: !PYTHON_URL!
    echo.
    
    :: PowerShellì„ ì‚¬ìš©í•˜ì—¬ Python ë‹¤ìš´ë¡œë“œ
    powershell -Command "& {[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12; Invoke-WebRequest -Uri '!PYTHON_URL!' -OutFile '!PYTHON_INSTALLER!' -UseBasicParsing}"
    
    if not exist "!PYTHON_INSTALLER!" (
        echo âŒ Python ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.
        echo ðŸ’¡ ìˆ˜ë™ìœ¼ë¡œ https://python.org ì—ì„œ Pythonì„ ì„¤ì¹˜í•´ì£¼ì„¸ìš”.
        pause
        exit /b 1
    )
    
    echo âœ… Python ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!
    echo.
    echo ðŸ”§ Python ì„¤ì¹˜ ì¤‘... (ì•½ 3-7ë¶„ ì†Œìš”)
    echo    âš ï¸  ì„¤ì¹˜ ì¤‘ì—ëŠ” ì°½ì„ ë‹«ì§€ ë§ˆì„¸ìš”!
    echo.
    
    :: Python ìžë™ ì„¤ì¹˜ (PATH ì¶”ê°€, pip ì„¤ì¹˜, ëª¨ë“  ì‚¬ìš©ìžìš©)
    "!PYTHON_INSTALLER!" /quiet InstallAllUsers=1 PrependPath=1 Include_test=0 Include_pip=1
    
    :: ì„¤ì¹˜ ì™„ë£Œ ëŒ€ê¸°
    timeout /t 10 /nobreak >nul
    
    echo ðŸ—‘ï¸  ìž„ì‹œ íŒŒì¼ ì •ë¦¬...
    del "!PYTHON_INSTALLER!" >nul 2>&1
    
    echo.
    echo ðŸ”„ ì‹œìŠ¤í…œ í™˜ê²½ë³€ìˆ˜ ìƒˆë¡œê³ ì¹¨...
    echo    ìž ì‹œ í›„ ì‹œìŠ¤í…œì„ ë‹¤ì‹œ ì‹œìž‘í•´ì•¼ í•  ìˆ˜ë„ ìžˆìŠµë‹ˆë‹¤.
    
    :: í™˜ê²½ë³€ìˆ˜ ìƒˆë¡œê³ ì¹¨
    call :RefreshEnv
    
    :: Python ì„¤ì¹˜ í™•ì¸
    python --version >nul 2>&1
    if !errorLevel! neq 0 (
        echo âŒ Python ì„¤ì¹˜ê°€ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
        echo ðŸ’¡ ì»´í“¨í„°ë¥¼ ìž¬ì‹œìž‘í•œ í›„ ë‹¤ì‹œ ì‹¤í–‰í•´ì£¼ì„¸ìš”.
        echo.
        set /p restart="ì§€ê¸ˆ ìž¬ì‹œìž‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/n): "
        if /i "!restart!"=="y" (
            shutdown /r /t 10 /c "Python ì„¤ì¹˜ ì™„ë£Œ í›„ ìž¬ì‹œìž‘"
            echo ðŸ”„ 10ì´ˆ í›„ ìž¬ì‹œìž‘ë©ë‹ˆë‹¤...
        )
        pause
        exit /b 1
    )
    
    echo âœ… Python ì„¤ì¹˜ ì™„ë£Œ!
) else (
    echo âœ… Pythonì´ ì´ë¯¸ ì„¤ì¹˜ë˜ì–´ ìžˆìŠµë‹ˆë‹¤.
    for /f "tokens=*" %%i in ('python --version 2^>^&1') do echo    ë²„ì „: %%i
)
echo.

:: 2. pip ì—…ê·¸ë ˆì´ë“œ
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo 2ï¸âƒ£  pip ì—…ê·¸ë ˆì´ë“œ ì¤‘...
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
python -m pip install --upgrade pip
echo âœ… pip ì—…ê·¸ë ˆì´ë“œ ì™„ë£Œ!
echo.

:: 3. ê°€ìƒí™˜ê²½ ìƒì„±
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo 3ï¸âƒ£  ê°€ìƒí™˜ê²½ ìƒì„± ì¤‘...
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if exist "excel_merger_env" (
    echo ðŸ—‘ï¸  ê¸°ì¡´ ê°€ìƒí™˜ê²½ ì‚­ì œ ì¤‘...
    rmdir /s /q excel_merger_env
)

echo ðŸ“¦ ìƒˆë¡œìš´ ê°€ìƒí™˜ê²½ ìƒì„± ì¤‘...
python -m venv excel_merger_env

if not exist "excel_merger_env" (
    echo âŒ ê°€ìƒí™˜ê²½ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.
    pause
    exit /b 1
)

echo âœ… ê°€ìƒí™˜ê²½ ìƒì„± ì™„ë£Œ!
echo.

:: 4. ê°€ìƒí™˜ê²½ í™œì„±í™” ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo 4ï¸âƒ£  í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ ì¤‘...
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

call excel_merger_env\Scripts\activate

echo ðŸ“¥ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ ì¤‘... (ì•½ 3-5ë¶„ ì†Œìš”)
echo    - streamlit (ì›¹ ì¸í„°íŽ˜ì´ìŠ¤)
echo    - pandas (ë°ì´í„° ì²˜ë¦¬)  
echo    - openpyxl (ì—‘ì…€ íŒŒì¼ ì²˜ë¦¬)
echo    - xlrd (êµ¬í˜• ì—‘ì…€ íŒŒì¼ ì§€ì›)
echo    - pyinstaller (ì‹¤í–‰íŒŒì¼ ìƒì„±)
echo.

pip install streamlit==1.28.1
pip install pandas==2.1.3  
pip install openpyxl==3.1.2
pip install xlrd==2.0.1
pip install pyinstaller==6.2.0

echo âœ… ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ ì™„ë£Œ!
echo.

:: 5. í•„ìˆ˜ íŒŒì¼ í™•ì¸
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo 5ï¸âƒ£  í•„ìˆ˜ íŒŒì¼ í™•ì¸ ì¤‘...
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

set MISSING_FILES=0

if not exist "excel_merger_web.py" (
    echo âŒ excel_merger_web.py íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.
    set MISSING_FILES=1
)

if not exist "launcher.py" (
    echo âŒ launcher.py íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.
    set MISSING_FILES=1
)

if !MISSING_FILES! equ 1 (
    echo.
    echo âš ï¸  í•„ìˆ˜ íŒŒì¼ì´ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤!
    echo ðŸ’¡ ë‹¤ìŒ íŒŒì¼ë“¤ì„ ê°™ì€ í´ë”ì— ë„£ì–´ì£¼ì„¸ìš”:
    echo    - excel_merger_web.py (ë©”ì¸ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜)
    echo    - launcher.py (ëŸ°ì²˜ ìŠ¤í¬ë¦½íŠ¸)
    echo.
    pause
    exit /b 1
)

echo âœ… ëª¨ë“  í•„ìˆ˜ íŒŒì¼ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤!
echo.

:: 6. ì‹¤í–‰íŒŒì¼ ìƒì„±
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo 6ï¸âƒ£  ì‹¤í–‰íŒŒì¼ ìƒì„± ì¤‘... (ì•½ 2-5ë¶„ ì†Œìš”)
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

echo ðŸ”¨ PyInstallerë¡œ ì‹¤í–‰íŒŒì¼ ìƒì„± ì¤‘...
echo    ì´ ê³¼ì •ì—ì„œ ì‹œê°„ì´ ë§Žì´ ê±¸ë¦´ ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...
echo.

pyinstaller --onefile --noconsole --name "ì—‘ì…€í†µí•©ê¸°_charmleader" --add-data "excel_merger_web.py;." --hidden-import streamlit --hidden-import pandas --hidden-import openpyxl --hidden-import xlrd launcher.py

if not exist "dist\ì—‘ì…€í†µí•©ê¸°_charmleader.exe" (
    echo âŒ ì‹¤í–‰íŒŒì¼ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.
    echo ðŸ’¡ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í™•ì¸í•˜ê³  charmleader@gmail.comìœ¼ë¡œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.
    pause
    exit /b 1
)

echo âœ… ì‹¤í–‰íŒŒì¼ ìƒì„± ì™„ë£Œ!
echo.

:: 7. ì •ë¦¬ ìž‘ì—…
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo 7ï¸âƒ£  ì •ë¦¬ ìž‘ì—… ì¤‘...
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

echo ðŸ“ ì‹¤í–‰íŒŒì¼ì„ í˜„ìž¬ í´ë”ë¡œ ì´ë™ ì¤‘...
move "dist\ì—‘ì…€í†µí•©ê¸°_charmleader.exe" . >nul 2>&1

echo ðŸ—‘ï¸  ìž„ì‹œ í´ë” ì •ë¦¬ ì¤‘...
rmdir /s /q build >nul 2>&1
rmdir /s /q dist >nul 2>&1  
del "ì—‘ì…€í†µí•©ê¸°_charmleader.spec" >nul 2>&1

echo âœ… ì •ë¦¬ ìž‘ì—… ì™„ë£Œ!
echo.

:: ì™„ë£Œ ë©”ì‹œì§€
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo                           ðŸŽ‰ ì„¤ì¹˜ ì™„ë£Œ! ðŸŽ‰
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo âœ… ëª¨ë“  ìž‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!
echo.
echo ðŸ“„ ìƒì„±ëœ íŒŒì¼: ì—‘ì…€í†µí•©ê¸°_charmleader.exe
echo ðŸ’¡ ì‚¬ìš©ë²•:
echo    1. ìœ„ ì‹¤í–‰íŒŒì¼ì„ ë”ë¸”í´ë¦­
echo    2. ì›¹ ë¸Œë¼ìš°ì €ê°€ ìžë™ìœ¼ë¡œ ì—´ë¦¼
echo    3. ì—‘ì…€ íŒŒì¼ë“¤ì„ ì—…ë¡œë“œí•˜ê³  í†µí•©!
echo.
echo ðŸŽ íŠ¹ì§•:
echo    - ì™„ì „ ìžë™í™”ëœ ë²„ì „ ê´€ë¦¬
echo    - ì›¹ ê¸°ë°˜ ì‚¬ìš©ìž ì¹œí™”ì  ì¸í„°íŽ˜ì´ìŠ¤  
echo    - ì•ˆì „í•œ íŒŒì¼ ì²˜ë¦¬
echo    - í•˜ë‚˜ì˜ ì‹¤í–‰íŒŒì¼ë¡œ ì–´ë””ì„œë“  ì‚¬ìš© ê°€ëŠ¥
echo.
echo ðŸ“§ ì œìž‘ìž: charmleader@gmail.com
echo ðŸ’Œ ë¬¸ì˜ ë° í”¼ë“œë°± ì–¸ì œë“  í™˜ì˜í•©ë‹ˆë‹¤!
echo.
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

set /p run_now="ì§€ê¸ˆ ë°”ë¡œ ì‹¤í–‰í•´ë³´ì‹œê² ìŠµë‹ˆê¹Œ? (y/n): "
if /i "!run_now!"=="y" (
    echo.
    echo ðŸš€ ì—‘ì…€ í†µí•©ê¸°ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤...
    start "" "ì—‘ì…€í†µí•©ê¸°_charmleader.exe"
)

echo.
echo ðŸ‘‹ ì„¤ì¹˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤!
pause
exit /b 0

:: í™˜ê²½ë³€ìˆ˜ ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜
:RefreshEnv
for /f "tokens=*" %%i in ('reg query "HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Environment" /v PATH ^| findstr REG_') do (
    for /f "tokens=2*" %%j in ("%%i") do set "SystemPath=%%k"
)
for /f "tokens=*" %%i in ('reg query "HKCU\Environment" /v PATH 2^>nul ^| findstr REG_') do (
    for /f "tokens=2*" %%j in ("%%i") do set "UserPath=%%k"
)
if defined UserPath (
    set "PATH=%SystemPath%;%UserPath%"
) else (
    set "PATH=%SystemPath%"
)
goto :eof